<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:site" content="@TI_EU" />
	<meta name="twitter:creator" content="@eucampaign" />
	<meta property="og:url" content="http://www.integritywatch.eu" />
	<meta property="og:title" content="EU Integrity Watch: monitor potential conflicts of interests" />
	<meta property="og:description" content="Who’s #lobbying the EU Commission and how much are they spending? Check Integrity Watch" />
	<meta property="og:image" content="http://www.integritywatch.eu/img/thumbnail.jpg" />
	<meta property="fb:app_id" content="1611680135716224" />
	<title>Integrity Watch Chile</title>
	<link rel="shortcut icon" href="favicon.ico">
	<link href="css/bower.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/dc.css"/>
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
	<script type="text/javascript" src="js/bower.js"></script>
	
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the pdate via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	<style>
		td.dc-table-column._4,
		td.dc-table-column._5,
		td.dc-table-column._6
		{text-align:left;}

		#mep_number {
				margin-top: 0.1em;}
		.l_data_container {
			padding: 10px 15px;
			margin: -10px;
			background: #d4eaf6;
		}
		.l_data_container div {
			border: none;
			margin-top: 0;
			padding-bottom: 0;
			margin: 5px 0 5px 0;
		}
		.l_data_container_main {
			background: #d4eaf6;
			margin-bottom: 20 !important;
			font-size: 18px;
			text-align: center;
		}
		.l_data_container label {
			font-weight: 600;
		}
		.l_data_container_main label {
			color: #333;
		}
		.l_data_container_host {
			border: 4px solid #0f4c79 !important;
			border-right: 3px solid #0f4c79 !important;
			margin-top: 0 !important;
			//height: 230px;
			padding: 10px 15px !important;
			background: #fff;
		}
		.l_data_container_guest {
			border: 4px solid #8e1556 !important;
			border-left: 3px solid #8e1556 !important;
			margin-top: 0 !important;
			//height: 230px;
			padding: 10px 15px !important;
			background: #fff;
		}
		.l_data_container_guest label, .l_data_container_guest .data_container_title {
			color: #8e1556 !important;
		}
		.l_data_container_host label, .l_data_container_host .data_container_title {
			color: #0f4c79 !important;
		}
		.data_container_title {
			font-size: 15px;
			font-weight: 800;
			text-transform: uppercase;
			
		}
		.legend div.individual::before {
			background: #af0700 none repeat scroll 0 0;
		}
		.legend div.tradeunion::before {
			background: #f6b862 none repeat scroll 0 0;
		}
		.legend div.companies::before {
			background: #fcb000 none repeat scroll 0 0;
		}
		.otro::before {
			background: #bbb;
		}
		.main_category svg, .hosttype svg, .categoria svg {
			overflow: visible !important;
		}
		.navbar .navbar-nav > li > a {
			width: 160px;
		}
		#filter_wrap #currently_selected_text {
			width: 150px;
		}
		.dectype text.pie-slice, .topprofessions text.pie-slice {
			display: none !important;
		}
		#gobierno_btn {
			height: 100px;
		}
		.filter_btn_container {
			padding: 40px 0 50px 0;
		}
		.salario-box-1 {
			border: 2px solid #5b9bd5 !important;
			padding: 10px 20px !important;
			text-align: center;
		}
		.salario-box-2 {
			border: 2px solid #f68d47 !important;
			padding: 10px 20px !important;
			text-align: center;
		}
		.infobox-divider {
			height: 2px;
			background: #5b9bd5;
		}
	</style>
</head>

<body>

<script>
	//Additional date sorting for datatables
	var dmy = d3.time.format("%d/%m/%Y");
	jQuery.extend( jQuery.fn.dataTableExt.oSort, {
		"date-eu-pre": function ( date ) {
					return dmy.parse(date);
		},
		"date-eu-asc": function ( a, b ) {
			return ((a < b) ? -1 : ((a > b) ? 1 : 0));
		},
		"date-eu-desc": function ( a, b ) {
			return ((a < b) ? 1 : ((a > b) ? -1 : 0));
		}
	} );
	//Doc ready
	$( document ).ready(function() {
		$('#view_charts').click(function(ev) {
			ev.preventDefault();
			$('#hidden_charts_wrap').slideToggle('slow', function () {
				changeLinkStatus();
			})
		})
		function changeLinkStatus() {
			if($('#hidden_charts_wrap').css('display') == 'none'){
				$('#view_charts').text('VIEW ALL THE CHARTS')
			}else {
				$('#view_charts').text('HIDE CHARTS')
			}
			$('#view_charts').toggleClass('hiddencharts');
		}
		$('#collapse_about a').click(function(ev) {
			ev.preventDefault();
			$('#collapse_about a').toggleClass('opened');
			$('#collapse_about a').toggleClass('closed');
			$('#about_wrap').slideToggle('slow', function () {
				$('#about_wrap_top').slideToggle('fast')
			})	
		})
		$('.info').click(function(ev) {
			ev.preventDefault();
			if($(this).hasClass('opened')){
				$(this).removeClass('opened');
				$(this).parents('.info_chart').find('p.desc').slideUp('fast')
			}else{
				closeAllInfos();
				$(this).addClass('opened');
				$(this).parents('.info_chart').find('p.desc').slideDown('fast')
			}
		});
		function closeAllInfos() {
			$('.info').removeClass('opened');
			$('p.desc').slideUp('fast');
		}
	});
	//End doc ready

	//Main vars for modal panels
	var detailtpl = sidetpl = null ;
	var wall = null;

	//Grid function (generates graphs and counts)
	function grid (selector,data) {
		
		var ndx = crossfilter(data),
				all = ndx.groupAll();

		var color = d3.scale.linear()
					.clamp(true)
					.domain([0,1, 70])
					.range(["white","#ffc7b6", "#f85631"])
					.interpolate(d3.interpolateHcl);

		evt = ndx.dimension(function(d) {
			return d.id;		
		})
		var eventgroup   = evt.group().reduce(
			function(p,d) {  
				p.nb +=1;
				if (!d.organisation)
				  return p;
				p.fte += d.fte;
				p.accredited += d.accredited;
				return p;
			},
			function(p,d) {  
				p.nb -=1;
				 if (!d.organisation)
				   return p;
				p.fte -= d.fte;
				p.accredited -= d.accredited;
				return p;
			},
			function(p,d) {  
				return {nb:0,fte:0,accredited:0}; 
			}
		);
		var count=dc.dataCount(".dc-data-count")
			.dimension(eventgroup)
			.group({value: function() {
				return eventgroup.all().filter(function(kv) { return kv.value.nb>0; }).length;
			}});

		count.on("renderlet.resetall", function(c) {
				var total=c.dimension().size();
				var filtered= c.group().value();
				var disabled= (total == filtered);

				//$(".resetall").attr("disabled",disabled);
				ga && ga('send', 'event', 'filter', 'subset', filtered);

				if (filtered >=0) {
					var one2one=0;
					eventgroup.all().forEach(function(d) { if(d.value ==1) one2one ++;});
					var ratio=Math.round(100-one2one/filtered*100);
					$(".one2one").html( ratio + "% collective meetings");
				}
		  RefreshTable();
		});

		dc.dataCount(".dc-data-count2")
			.dimension(ndx)
			.group(all);

		nameEvent = ndx.dimension(function(d) {
			/*
			if (d.nombrePasivo) {
					return d.nombrePasivo.toLowerCase()+" "+d.apellidosPasivo.toLowerCase()+" "+d.nombreInstitucion.toLowerCase()+" "+d.observacionesMateriaAudiencia.toLowerCase()+ " ";   
			}
			return d.nombrePasivo.toLowerCase()+" "+d.apellidosPasivo.toLowerCase()+" "+d.nombreInstitucion.toLowerCase()+" "+d.observacionesMateriaAudiencia.toLowerCase()+ " ";
			*/
			return d.fullName + " cargo:" + d.Cargo.toLowerCase();
		});

		//Draw graphs
		drawTable();
		//drawCloud();
		drawDecType();
		//drawCategoria();
		//drawTopGuest();
		//drawTopHost();
		//drawTopIstitucion();
		drawActivities();
		drawActivitiesPro();
		drawVehicles();
		drawInmuebles();
		drawAcciones();
		drawAccionesVal();
		drawProfessions();
		drawIncome();

		function rotateBarChartLabels(chart) {
			chart.svg().selectAll('.axis.x text')
				.style("text-anchor", "end" )
				.attr("transform", function(d) { return "rotate(-45, -4, 9) "; });

		}
		function setword(wd) {
			$("#search-input").val(wd);
			var s = wd.toLowerCase();
			nameEvent.filter(function (d) { 
				return d.indexOf (s) !== -1;} );
			$(".resetall").attr("disabled",false);
			throttle();
			var throttleTimer;
			function throttle() {
				window.clearTimeout(throttleTimer);
				throttleTimer = window.setTimeout(function() {
					console.log ("redraw");
						dc.redrawAll();
				}, 250);
			}
		}

		//WordCloud Chart
		function drawCloud() {
			 var dim = ndx.dimension(function(d) {
			  return d.observacionesMateriaAudiencia || "";
			 })
			 var group   = dim.group().reduceSum(function(d) { return 1; });
			 var graph =  dc.wordCloud(".wordcloud")
			  .rotate(function() { return ~~(Math.random() * 2) * 90; })
			  .size([320,380])
			  .dimension(dim)
			  .maxWords(50)
			  .padding(5)
			  .ordinalColors(['#133d82', '#2163ad', '#3893d1', '#84c0e8', '#cfecff'])
			  .group(group)
			  .scale(d3.scale.linear().domain([10,100]).range([6, 30]))
			  .textAccessor(function(d) {return d.observacionesMateriaAudiencia;})
			  .onClick(function(d){setword(d.key);})
			  .stopWords (/^(está|grupo|entre|n°|conocer|sector|plan|posición|Informar|9729|marco|lógicas|Nueva|ley|Actos|millas|código|Idi|actual|ex|entrega|Modifica|21|crea|DFL|carrera|término|respecto|dado|Atención|Obcervaciones|2016|uso|requieren|continuidad|manera|posibles|podrían|entrega|Dar|país|alternativa|condiciones|comentarios|horas|julio|actualmente|impacto|busca|moderniza|Fortalece|OTRAS|grabadas|audiancia|atención|preocupación|situación|tema|algunos|sistema|9936|Proyecto|7606|acuerdo|acuerdos|centralizado|1100|22|mayo|Lunes|asesor|previo|Operadores|moción|parlamentaria|normas|Consultas|Fija|acción|REINTEGRO|Finalmente|proyecto|presentación|empresa|hacer|encuentro|red|presente|Minsterio|DS|respecto|seremi|Intendente|Comuna|Ley|Audiencia|Web|Apoyo|Construye|Inmobiliaria|2016201|ha|changes|categoria|65892690k|fecha|características|•|compromiso|matriz|idea|temática|RUT|–|em|tiene|suponia|Estaciones|dia|ha|proceso|señala|todas|Rojas|reunión|1000|nuevo|19|aspectos|ceremonial|they|operación|consulta|semana|SEC|oferta|conocer|PERCEPCIONES|INFORME|Solicita|pago|Generales|actual|fruto|generados|involucraría|contribuyendo|regional|Solicitud|desea|abordar|adquiro|temas|está|2015|Agenda|Prioridades|hitos|tabla|SerenaVarasSe|Ubicada|Pronunciamiento|Extraordinarias|Reparación|Obra|obras|V°B°|Villa|Servidas|2292002|Politica|zona|central|Productivo|SA|entre|tres|uso|4|19|o|avance|Nuevo|Región|Poder|son|acuerdo|medidas|correctivas|PortalesTemas|cómo|Ampliación|montos|pago|Octubre|encuentran|modificación|ciudad|1|N°2|gestión|salvaguardar|Mediante|estructural|Tratar1|plazo|Juego|Presentar|NOSOTROS|playa|Fallo|han|mesa|denegación|bis|Art|Sostiene|importancia|través|objetivo|todos|qué|Animas|nos|2|esta|como|N°|0|3|Sr|una|más|lo|es|este|sus|e|ya|el|del|que|las|los|al|un|su|para|por|se|con|sobre|y|i|me|my|myself|we|us|our|ours|ourselves|you|your|yours|yourself|yourselves|he|him|his|himself|she|her|hers|herself|it|its|itself|they|them|their|theirs|themselves|what|which|who|whom|whose|this|that|these|those|am|is|are|was|were|be|been|being|have|has|had|having|do|does|did|doing|will|would|should|can|could|ought|i'm|you're|he's|she's|it's|we're|they're|i've|you've|we've|they've|i'd|you'd|he'd|she'd|we'd|they'd|i'll|you'll|he'll|she'll|we'll|they'll|isn't|aren't|wasn't|weren't|hasn't|haven't|hadn't|doesn't|don't|didn't|won't|wouldn't|shan't|shouldn't|can't|cannot|couldn't|mustn't|let's|that's|who's|what's|here's|there's|when's|where's|why's|how's|a|an|the|and|but|if|or|because|as|until|while|of|at|by|for|with|about|against|between|into|through|during|before|after|above|below|to|from|up|upon|down|in|out|on|off|over|under|again|further|then|once|here|there|when|where|why|how|all|any|both|each|few|more|most|other|some|such|no|nor|not|only|own|same|so|than|too|very|say|says|said|shall|la|du|mr|commissioner|et|des|dg|commission|de|pour|en|les|le|meeting|eu|new|priorities|presentation|preparation|issues|meetings|representatives|work|implementation|general|future|challenge|challenge|skey|role|exchange|views|discuss|discussion|various director|talks|position|global|field|level|initiative|company|state|aspects|context|current|change|european|potential|including|dans|within|developments|play|present|Päris|Enegry|deep|Susan|Danger|Managing|Director|AmCham|Karl|Cox|Vice|President|Oracle| Bert|Boers|SAS|Marco|Comastri|EMEA|CA|Patrick|Deconinck|Senior|Western|3M|Harry|van| Dorenmalen|Chairman|IBM|Aongus|Hegarty|Dell|Cindy|Miller|UPS|Christian|Morales|Manager|Intel| |Julián|Nebreda|AES|Peter|Ryan|VP|HP|Nigel|Lewis|Caterpillar|Dirk|Ostijn|Head|&| Chief|Executive |Officer|MetLife|CA|flagship|related|portfolio|Cssr|Jourova|(| voting|all|expats|as|part|)|,|Year)$/);

		}
		
		function activitiesRange(num){
			if(num >= 1 && num < 5){
				return "1 - 4";
			}
			if(num >= 5){
				return "5 +";
			}
			return "0";
		}
		
		//Type
		function drawDecType() {
			var dim = ndx.dimension (function(d) {
					return d.Tipo;   
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });
			/*
			var typecolor = {			
				"0":"#8da9db",
				"1 - 4":"#a8d08c",
				"5 +":"#f4b081"
			};
			*/
			var chart = dc.pieChart(".dectype")
				.innerRadius(0).radius(130)
				//.margins({top: 0, right: 3, bottom: 20, left: 3})
				.cy(150)
				.height(420)
				.dimension(dim)
				.cap(7)
				.group(group)	
				/*				
				.colorCalculator(function(d, i) {
					return typecolor[d.key];
				});
				*/
				chart.legend(dc.legend().x(30).y(320).itemHeight(13).gap(5))
		}
		
		//Activities
		function drawActivities () {
			var dim = ndx.dimension (function(d) {
					return activitiesRange(d.activity.length);   
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });
			var typecolor = {			
				"0":"#8da9db",
				"1 - 4":"#a8d08c",
				"5 +":"#f4b081"
			};
			var chart = dc.pieChart(".nactividades")
				.innerRadius(0).radius(100)
				.height(250)
				.dimension(dim)
				.cap(7)
				.group(group)				
				.colorCalculator(function(d, i) {
					return typecolor[d.key];
				});
				chart.legend(dc.legend().x(30).y(220).itemHeight(13).gap(5))
		}
		
		//Professional Activities
		function drawActivitiesPro () {
			var dim = ndx.dimension (function(d) {
					return activitiesRange(d.activityPro.length);   
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });
			var typecolor = {			
				"0":"#8da9db",
				"1 - 4":"#a8d08c",
				"5 +":"#f4b081"
			};
			var chart = dc.pieChart(".nproactividades")
				.innerRadius(0).radius(100)
				.height(250)
				.dimension(dim)
				.cap(7)
				.group(group)				
				.colorCalculator(function(d, i) {
					return typecolor[d.key];
				});
				chart.legend(dc.legend().x(30).y(220).itemHeight(13).gap(5))
		}
		
		//Category Chart (Lobbyist or gestores de intereses)
		function drawCategoria() {
			var dim = ndx.dimension (function(d) {
					return d.categoriaA;   
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });
			var hosttypecolor = {			
				"Lobbyistas":"#5b9bd5",
				"Gestores de intereses":"#ed7d31",
				"Unknown":"#bbbbbb"
			};
			var chart = dc.pieChart(".categoria")
				.innerRadius(70).radius(100)
				.height(250)
				.dimension(dim)
				.cap(7)
				.group(group)
				//.legend(dc.legend().x(0).y(190).gap(10)) TODO: use dc.legend		
				.colorCalculator(function(d, i) {
					return hosttypecolor[d.key];
				});
				chart.legend(dc.legend().x(30).y(240).itemHeight(13).gap(5))
		}
		
		function bienesRange(num){
			if(num >= 5){
				return "5+";
			}
			return num.toString();
		}

		//Vehicles
		function drawVehicles () {
			var dim = ndx.dimension (function(d) {
				return bienesRange(d.mueble.length);
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });

			var graph = dc.barChart(".vehicles")   
				.margins({top: 10, right: 3, bottom: 20, left: 30})
				.height(270)
				//.width(165)
				.gap(8)
				.x(d3.scale.ordinal().domain(["0", "1", "2", "3", "4", "5+"]))
				.xUnits(dc.units.ordinal)
				.elasticY(true)
				.colorCalculator(function(d, i) {
					return "#84c0e9";
				})
				//.ordering(function(d){return -d.value})
				.dimension(dim)
				.group(group);
				
			//graph.yAxis().ticks(5).tickFormat(d3.format("d"));
		};
		
		//Acciones
		function drawAcciones () {
			var dim = ndx.dimension (function(d) {
				return bienesRange(d.acciones.length);
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });

			var graph = dc.barChart(".empresas")   
				.margins({top: 10, right: 3, bottom: 20, left: 30})
				.height(270)
				//.width(165)
				.gap(8)
				.x(d3.scale.ordinal().domain(["0", "1", "2", "3", "4", "5+"]))
				.xUnits(dc.units.ordinal)
				.elasticY(true)
				.colorCalculator(function(d, i) {
					return "#84c0e9";
				})
				//.ordering(function(d){return -d.value})
				.dimension(dim)
				.group(group);
				
			//graph.yAxis().ticks(5).tickFormat(d3.format("d"));
		};
		
		//Inmuebles
		function drawInmuebles () {
			var dim = ndx.dimension (function(d) {
				return bienesRange(d.inmueble.length);
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });

			var graph = dc.barChart(".inmuebles")   
				.margins({top: 10, right: 3, bottom: 20, left: 30})
				.height(270)
				//.width(165)
				.gap(8)
				.x(d3.scale.ordinal().domain(["0", "1", "2", "3", "4", "5+"]))
				.xUnits(dc.units.ordinal)
				.elasticY(true)
				.colorCalculator(function(d, i) {
					return "#84c0e9";
				})
				//.ordering(function(d){return -d.value})
				.dimension(dim)
				.group(group);
				
			//graph.yAxis().ticks(5).tickFormat(d3.format("d"));
		};
		
		//Top Institutions Chart
		function drawTopIstitucion() {
			var dim = ndx.dimension (function(d) {
				return d.nombreInstitucion;
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });

			var filteredGroup = (function(source_group) {
				return {
					all: function() {
						return source_group.top(20).filter(function(d) {
							return (d.key != "Not mentioned" && d.value != 0);
						});
					}
				};
			})(group);
			var graph = dc.rowChart(".topistitucion")   
				.margins({top: 0, right: 3, bottom: 20, left: 3})
				.height(730)
				//.width(360)
				.gap(1)
				//.fixedBarHeight(20)
				.x(d3.scale.ordinal())
				.elasticX(true)
				.colorCalculator(function(d, i) {
					return "#84c0e9";
				})
				.ordering(function(d){return -d.value})
				.dimension(dim)
				.group(filteredGroup);
		};
		
		function incomeRange (valor) {
			//var thisval = valor;
			//alert(thisval);
			/*
			if(isNaN(thisval)){
				alert(thisval);
				if(thisval == "A"){thisval = 9904720}
				else if(thisval == "B" || thisval == "1-B"){thisval = 9121809}
				else if(thisval == "C"){thisval = 8393125}
				else if(thisval == "Dieta Parlmentaria"){thisval = 9121809}
				else {
					thisval = "N/A";
				}
			}
			*/
			valor = parseInt(valor);
			if (valor <= 50000 ) return "<= MM$50"; 
			if (valor < 100000 ) return "MM$50 - MM$100"; 
			if (valor < 500000 ) return "MM$100 - MM$500"; 
			if (valor < 1000000 ) return "MM$500 - MM$1000"; 
			if (valor < 5000000 ) return "MM$1000 - MM$5000"; 
			if (valor < 10000000 ) return "MM$5000 - MM$10000"; 
			return "> MM$10000";
		}
		
		//Income
		function drawIncome () {
			var dim = ndx.dimension (function(d) {
				//return incomeRange(d.Grado);
				//alert(d.accionestot + ' ' + d.valorestot + ' ' + (d.accionestot + d.valorestot));
				return incomeRange(d.accionestot + d.valorestot);
			});
			var group = dim.group().reduceSum(function(d) { return 1; });

			/*
			var graph = dc.barChart(".income")   
				.margins({top: 10, right: 3, bottom: 20, left: 30})
				.height(350)
				//.width(165)
				.gap(8)
				.x(d3.scale.ordinal().domain(["", "<= MM$50", "MM$50 - MM$100", "MM$100 - MM$500", "MM$500 - MM$1000", "MM$1000 - MM$5000", "MM$5000 - MM$10000", "> MM$10000"]))
				//.x(d3.scale.ordinal().domain(dim)) 
				.xUnits(dc.units.ordinal)
				.elasticY(true)
				.colorCalculator(function(d, i) {
					return "#84c0e9";
				})
				//.ordering(function(d){return -d.value})
				.dimension(dim)
				.group(group);
			*/
			
			//graph.yAxis().ticks(5).tickFormat(d3.format("d"));
			var graph = dc.rowChart(".income")  
				.height(350)
				.gap(8)
				.elasticX(true)
				.dimension(dim)
				.group(group);
		};
		
		function accionesRange (valor) {
			valor = parseInt(valor);
			if (valor === 0 ) return "0"; 
			if (valor < 10000000 ) return "1 - 10M"; 
			if (valor < 50000000 ) return "10M - 50M"; 
			if (valor < 100000000 ) return "50M - 100M"; 
			if (valor < 1000000000 ) return "100M - 1B"; 
			return "> 1 Billion";
		}
		
		//accionesval
		function drawAccionesVal () {
			var dim = ndx.dimension (function(d) {
			//alert(d.toSource());
				//return accionesRange(d.accionestot);
				return accionesRange(d.accionestot + d.valorestot);
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });

			var graph = dc.barChart(".accionesval")   
				.margins({top: 10, right: 3, bottom: 20, left: 30})
				.height(300)
				//.width(165)
				.gap(8)
				.x(d3.scale.ordinal().domain(["0", "1 - 10M", "10M - 50M", "50M - 100M", "100M - 1B", "> 1 Billion"])) // Need empty val to offset first value
				.xUnits(dc.units.ordinal)
				.elasticY(true)
				.colorCalculator(function(d, i) {
					return "#84c0e9";
				})
				//.ordering(function(d){return -d.value})
				.dimension(dim)
				.group(group);
				
			//graph.yAxis().ticks(5).tickFormat(d3.format("d"));
		};
		
		//topprofessions
		function drawProfessions() {
			var dim = ndx.dimension (function(d) {
					return d.Profesion;   
			});
			var group   = dim.group().reduceSum(function(d) {   return 1; });
			/*
			var typecolor = {			
				"0":"#8da9db",
				"1 - 4":"#a8d08c",
				"5 +":"#f4b081"
			};
			*/
			var chart = dc.pieChart(".topprofessions")
				.innerRadius(0).radius(130)
				//.margins({top: 0, right: 3, bottom: 20, left: 3})
				.cy(130)
				.height(370)
				.dimension(dim)
				.cap(10)
				.group(group)	
				/*				
				.colorCalculator(function(d, i) {
					return typecolor[d.key];
				});
				*/
				chart.legend(dc.legend().x(30).y(280).itemHeight(13).gap(5))
		}

		//Top 10 guests chart
		function drawTopGuest () {
			var dim = ndx.dimension (function(d) {
				return d.nombreEntidadActivo;
			});	
			var group = dim.group().reduceSum(function(d) { return 1; });
			var filteredGroup = (function(source_group) {
				return {
					all: function() {
						return source_group.top(11).filter(function(d) {
						return (d.key != "" && d.key != "Unknown" && d.key != "Not mentioned" && d.value != 0);
					});
				}
			};
		})(group);
		var graph = dc.rowChart(".guest")   
			.margins({top: 0, right: 3, bottom: 20, left: 3})
			.height(370)
			.width(165)
			.gap(3)
			.x(d3.scale.ordinal())
			.elasticX(true)
			.colorCalculator(function(d, i) {
				return "#ecb005";
			})
			.ordering(function(d){return -d.value})
			.dimension(dim)
			.group(filteredGroup);

			graph.xAxis().ticks(5).tickFormat(d3.format("d"));	
		};

		//Datatables table
		function drawTable () {
			var count=0;

			datatable = $(".table").dataTable({
				"columnDefs": [ {
				  "searchable": false,
				  "orderable": false,
				  "targets": 0,   
				  data: function ( row, type, val, meta ) {
					count++;
					return count;
				  }
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 1,
				  "defaultContent":"N/A",
				  "data":"fullName",
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 2,
				  "defaultContent":"N/A",
				  "data": function (d, type, val, meta) {
					 if (!d) return "";
					 return d.Cargo; 
					},
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 3,
				  "defaultContent":"N/A",
				  "data": function (d, type, val, meta) {
					 if (!d) return "";
					 return d.Partido; 
					},
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 4,
				  "defaultContent":"0",
				  "data": function (d, type, val, meta) {
					 if (!d) return "";
					 return d.activity.length; 
					},
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 5,
				  "defaultContent":"0",
				  "data": function (d, type, val, meta) {
					 if (!d) return "";
					 return d.inmueble.length; 
					},
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 6,
				  "defaultContent":"0",
				  "data": function (d, type, val, meta) {
					 if (!d) return "";
					 return d.mueble.length; 
					},
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 7,
				  "defaultContent":"N/A",
				  "data": function (d, type, val, meta) {
					 if (!d) return "";
					 return d.Grado; 
					},
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 8,
				  "defaultContent":"N/A",
				  "data": function (d, type, val, meta) {
					 if (!d) return "";
					 return "valor total activos"; 
					},
				  },{
				  "searchable": false,
				  "orderable": true,
				  "targets": 9,
				  "defaultContent":"N/A",
				  "data": function (d, type, val, meta) {
					 if (!d) return "";
					 return "activos adicionales"; 
					},
				  }
				],
				"iDisplayLength" : 100,
				"bPaginate": true,
				"bLengthChange": false,
				"bFilter": false,
				"order": [[ 1, "desc" ]],
				"bSort": true,
				"bInfo": false,
				"bAutoWidth": false,
				"bDeferRender": true,
				"aaData": nameEvent.top(Infinity),
				"bDestroy": true,
			});
			
			function addcommas(x){
				return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			}
		
			function countmeetings(who){
				var countedmeetings = _.filter(events, function(event, index) {
				  return event.nombrePasivoFull == who || event.nombreActivoFull == who;
				});
				return countedmeetings.length;
			}
			
			function renumeradoToText(ren){
				if(ren == 1){
					return "Si";
				} else if(ren == 0){
					return "No";
				}
				return "N/A";
			}
				
			function format (d) {				
				if (!d) return "no data";
				var monthNames = [
				  "January", "February", "March",
				  "April", "May", "June", "July",
				  "August", "September", "October",
				  "November", "December"
				];
				//alert(d.toSource());
				var day = d.date.getDate();
				var monthIndex = d.date.getMonth();
				var year = d.date.getFullYear();
				var thisdate = day + ' ' + monthNames[monthIndex] + ' ' + year;
				//var thishost = _.find(meetingspages, function (x) { return x.name == d.host });
				s = "<div class='l_data_container'>";
				s += "<div class='row'>";
				s += "<div class='col-md-6'>";
				s += "<div class='l_name'><label>Nombre</label> "+d.fullName+"</div>";
				s += "<div class='l_name'><label>Cargo</label> "+d.Cargo+"</div>";
				s += "<div class='l_name'><label>Partido</label> "+d.party+"</div>";
				s += "<div class='l_name'><label>Fecha assume el cargo</label> "+d.FAsuncion+"</div>";
				s += "</div><div class='col-md-6'><div class='row'><div class='col-md-6'>";
				s += "<div class='salario-box-1'><strong>Salario Bruto</strong><br />"+d.Grado+"</div>";
				s += "</div><div class='col-md-6'>";
				s += "<div class='salario-box-2'><strong>Valor Total Activos</strong><br />"+d.Grado+"</div>";
				s += "</div></div></div></div><div class='infobox-divider'></div>";
				
				s += "<div class='row'><div class='col-md-12'>";
				
				s += "<div class='l_name'><label>Actividades que realiza</label> "+d.activity.length+"</div>";
				if(d.activity.length > 0){
					s += "<table style='width:100%;'><thead><tr><th>Tipo de actividad</th><th>Objeto</th><th>Vinculo</th><th>Realizada Para</th><th>Renumerada</th><th>Fecha inicio</th></tr></thead><tbody>";
				}
				_.each(d.activity, function (a) {
					//s += a.toSource();
					s += "<tr style='border-bottom:1px solid #eee;'><td>"+a.TipoActividad+"</td><td>"+a.Objeto+"</td><td>"+a.Vinculo+"</td><td>"+a.RealizadaPara+"</td><td>"+renumeradoToText(a.Remunerado)+"</td><td>"+a.FechaInicio+"</td></tr>";
				});
				if(d.activity.length > 0){
					s += "</tbody></table>";
				}
				
				s += "<div class='l_name'><label>Empresas (acciones)</label> "+d.acciones.length+"</div>";
				if(d.acciones.length > 0){
					s += "<table style='width:100%;'><thead><tr><th>Titulo</th><th>Entidad</th><th>Cantidad</th><th>Fecha</th><th>Controlador</th></tr></thead><tbody>";
				}
				_.each(d.acciones, function (a) {
					//s += a.toSource();
					s += "<tr style='border-bottom:1px solid #eee;'><td>"+a.GravamenAccion+"</td><td>"+a.EntidadAccion+"</td><td>"+a.Cantidad+"</td><td>"+a.FechaAdquisicion+"</td><td>"+renumeradoToText(a.Controlador)+"</tr>";
				});
				if(d.acciones.length > 0){
					s += "</tbody></table>";
				}
				
				s += "<div class='l_name'><label>Propriedades</label> "+d.inmueble.length+"</div>";
				if(d.inmueble.length > 0){
					s += "<table style='width:100%;'><thead><tr><th>Region</th><th>Fecha de adquisición</th><th>Forma</th><th>Domicilio</th><th>Avalúo Fiscal</th></tr></thead><tbody>";
				}
				_.each(d.inmueble, function (a) {
					//s += a.toSource();
					s += "<tr style='border-bottom:1px solid #eee;'><td>"+a.NombreLugar+"</td><td>"+a.FechaAdquisicion+"</td><td>"+a.TipoPropiedad+"</td><td>"+renumeradoToText(a.EsSuDomicilio)+"</td><td>"+""+"</td></tr>";
				});
				if(d.inmueble.length > 0){
					s += "</tbody></table>";
				}
				
				s += "<div class='l_name'><label>Vehiculos</label> "+d.mueble.length+"</div>";
				if(d.mueble.length > 0){
					s += "<table style='width:100%;'><thead><tr><th>Typo</th><th>Marca</th><th>Modelo</th><th>Año de fabricación</th><th>Avalúo Fiscal</th></tr></thead><tbody>";
				}
				_.each(d.mueble, function (a) {
					//s += a.toSource();
					s += "<tr style='border-bottom:1px solid #eee;'><td>"+a.Tipo+"</td><td>"+a.Marca+"</td><td>"+a.Modelo+"</td><td>"+a.AnioFabricacion+"</td><td>"+a.Avaluo+"</td></tr>";
				});
				if(d.mueble.length > 0){
					s += "</tbody></table>";
				}
				
				s += "<div class='l_name'><label>Instrumento o valor transable</label> "+d.valores.length+"</div>";
				if(d.valores.length > 0){
					s += "<table style='width:100%;'><thead><tr><th>Titulo</th><th>Emissor</th><th>Fecha de adquisición</th><th>Pais</th><th>Valor</th></tr></thead><tbody>";
				}
				_.each(d.valores, function (a) {
					//s += a.toSource();
					s += "<tr style='border-bottom:1px solid #eee;'><td>"+a.TipoValor+"</td><td>"+a.EntidadQueEmite+"</td><td>"+a.FechaAdquisicion+"</td><td>"+a.PaisQueEmite+"</td><td>"+a.ValorPlaza+"</td></tr>";
				});
				if(d.valores.length > 0){
					s += "</tbody></table>";
				}
				
				s += "<div class='l_name'><label>Contratos y administracion de valores</label> /</div>";
				s += "No tiene información declarada en esta sección";
				
				s += "<div class='l_name'><label>Aguas Concesiones</label> /</div>";
				
				s += "<div class='l_name'><label>Pasivos</label> "+d.pasivos.length+"</div>";
				if(d.pasivos.length > 0){
					s += "<table style='width:100%;'><thead><tr><th>Tipo</th><th>Acreedor</th><th>Monto adeuado</th></tr></thead><tbody>";
				}
				_.each(d.pasivos, function (a) {
					//s += a.toSource();
					s += "<tr style='border-bottom:1px solid #eee;'><td>"+a.TipoPasivo+"</td><td>"+a.Acreedor+"</td><td>"+a.MontoPasivo+"</td></tr>";
				});
				if(d.pasivos.length > 0){
					s += "</tbody></table>";
				}
				
				s += "<div class='l_name'><label>Otras Fuentes de conflicto de intereses</label> /</div>";
				s += "No tiene información declarada en esta sección";
				
				s  += "</div></div>";
				/*
				s += "<div class='l_name'><label>Total audiencias</label> "+countmeetings(d.nombrePasivoFull)+"</div>";
				s += "<div class='l_name'><label>Cargo</label> "+d.cargoFuncionPasivo+"</div>";
				s += "<div class='l_name'><label>Institucion</label> "+d.nombrePasivoInstitucion+"</div>";
				s += "<div class='l_category'><label>Total participantes</label> "+d.participants+"</div>";
				s += "<div class='l_category'><label>Link audiencia</label> "+d.linkAudienciaReunionPasivo+"</div>";
				s += "<div class='l_category'><label>Link todas audiencias</label></div>";
				*/
				/*
				if(thishost){
					s += "<div class='l_category'><label>Link to meeting page</label> <a target='_blank' href='"+thishost.url+"'>"+thishost.url+"</a></div>";
				}
				*/
				/*
				var thisrep = representatives[d.guestid];
				var initiatives;
				url="http://api.lobbyfacts.nestor.coop/api/1/representative/"+thisrep .id+"?callback=?";
				$.getJSON( url, function( data ) {
					$('#initiatives'+thisrep .id).text(data.activity_eu_legislative);
					var height1 = $('.l_data_container_host').height();
					var height2 = $('.l_data_container_guest').height();
					if(height1 > height2){
						$('.l_data_container_guest').height(height1);
					} else {
						$('.l_data_container_host').height(height2);
					}
				}); 
				*/				
				//s += "<span class='lobbyist_info_container' id='lobbyist"+d.guestid+"'></span>"
				/*
				s += "</div>";
				s += "<div class='col-md-6 l_data_container_guest'>";
				s += "<div class='data_container_title'>Activo</div>";
				s += "<div class='l_category'><label>Nombre</label> "+d.nombreActivoFull+"</div>";
				s += "<div class='l_name'><label>Total audiencias</label> "+countmeetings(d.nombreActivoFull)+"</div>";
				s += "<div class='l_name'><label>Nombre entidad</label> "+d.nombreEntidadActivo+"</div>";
				s += "<div class='l_category'><label>Pais</label> "+d.documentoPaisActivo+"</div>";
				s += "<div class='l_category'><label>Giro</label> "+d.giroActivo+"</div>";
				s += "<div class='l_category'><label>Representante</label> "+d.representanteActivo+"</div>";
				s += "<div class='l_category'><label>Naturaleza</label> "+d.naturalezaActivo+"</div>";
				s += "<div class='l_category'><label>Tipo entidad</label> "+d.tipoEntidadActivo+"</div>";
				s += "</div>";
				s += "</div>";
				*/
				return s;
			}	
			//Datatables click function
			datatable.on('click', 'button', function () {
				var tr = $(this).closest('tr');
				var type=$(this).data("type");
				var pre=$(this).parent().parent().next("pre");
				var row = datatable.DataTable().row( tr.prev()[0] );
				var d=row.data();
			 
				if (type == "event") {
					var sevents =[];
					_.each(events,function (e){
					if (e.guestid == d.id)
					  sevents.push(e);
					});
					pre.html(JSON.stringify(sevents,null,2));
					return;
				}

				var r = (tr.data("representative"));
				if (!r) {
				  url="http://api.lobbyfacts.eu/api/1/representative/"+d.id+"?callback=?";
				  $.getJSON( url, function( data ) {
					tr.data("representative",data);
					display (data);
				  });
				  return;
				}
				display(r,type);

				function display (data) {
				  switch (type) {
					case "financial_data":
					 pre.html(JSON.stringify(data["financial_data"],null,2));
					  break;
					case "accreditation":
					 pre.html(JSON.stringify(data["accreditations"],null,2));
					  break;
					default:
					  pre.html(JSON.stringify(data,null,2));
				  }
				}
				
			});
		
			datatable.DataTable().on('click', 'tr[role="row"]', function () {
				var tr = $(this);
				var row = datatable.DataTable().row( tr );
				if ( row.child.isShown() ) {
					// This row is already open - close it
					row.child.hide();
					tr.removeClass('shown');
				}
				else {
					// Open this row
					row.child( format(row.data()) ).show();
					tr.addClass('shown');
					var height1 = $('.l_data_container_host').height();
					var height2 = $('.l_data_container_guest').height();
					if(height1 > height2){
						$('.l_data_container_guest').height(height1);
					} else {
						$('.l_data_container_host').height(height2);
					}
				}
			});
			
			datatable.DataTable().on( 'order.dt search.dt page.dt draw.dt', function () {
				var thispage = $('.paginate_button.current').html();			
				var rowi = 0;
			  datatable.DataTable().column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
				if(rowi >= 100){
					rowi = 0;
				}
				rowi ++;
				if(thispage > 1){
					cell.innerHTML = (rowi) + (100*(thispage-1));
				} else {
					cell.innerHTML = (rowi);
				}
			  });

			});
		}
		//End datatable table function

	   function RefreshTable() {
			dc.events.trigger(function () {
				alldata = evt.top(Infinity);
				datatable.fnClearTable();
				datatable.fnAddData(alldata);
				datatable.fnDraw();
			});
		}

		dc.renderAll();
		hashFilter();   

	}
	//End grid function

	function getAmountString(d) {
		if (d.qty == 0) {
			return "";
		}
		if (d.max == Number.POSITIVE_INFINITY)
			return "<span class='q"+d.qty+"' title='"+d.qty.length+" different occupations'>"+d.min+" &euro; or more</span>";
		return d.min +" &#8605; "+d.max +"  &euro;";
	}

	function getAmount (category, field) { //field = min (default) or max or "string"
		field = field || "min";
		if (!category) return "?";
		if (isNaN(category)) return category;
		if (category < 0 && field == "min") return "0";
		if (category < 0 && field == "max") return "499";
		if (category < 0 && field == "string") return "0  &#8605; 499 &euro;";
		 
		if (category >=4 && field == "max") return "or more";
		if (category >=4 && field == "string") return rangeEUR[category]["min"] + " or more";
		if (field == "string")
			return  rangeEUR[category]["min"] + " &#8605; "+  rangeEUR[category]["max"];
		return rangeEUR[category][field];
	}

	function hashFilter () {
		var hash = window.location.hash;
		if(hash.indexOf('#mep') === 0) { 
			eventpopup(hash.substring(4));
			ga && ga('send', 'event', 'urlevent',hash.substring(4));
		}
	}
		 
	function eventpopup (epid) {
		window.location.hash = "event"+d.epid;
		ga && ga('send', 'event', 'clickevent',hash.substring(4));
	}

</script>


<nav class="navbar navbar-default" role="navigation">
	<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<div class="navbar-brand" id="ti_logo_container">
						<a id="ti_logo" href="http://transparency.eu">Transparency International</a>
						<a id="page_title" href="/" target="_blank">Integrity<br />Watch <strong>Chile</strong></a>
				</div>
			</div>
		
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li class="active" id="cm_tool_btn"><a href="iw_chile.html"><strong>Audiencias</strong> <br />Gobierno Central</a></li>
					<li class="" id="cm_tool_btn"><a href="iw_chile_tab2.html"><strong>Audiencias</strong> <br />Congreso Nacional</a></li>
					<li class="dropdown">
						<a aria-expanded="false" aria-haspopup="true" role="button" data-toggle="dropdown" class="dropdown-toggle" href="#" style="width: 160px;">Otras versiones<span class="caret"></span></a>
						 <ul class="dropdown-menu">
							<li><a href="http://www.integritywatch.eu">IW EU</a></li>
						    <li><a href="http://www.integritywatch.fr">IW France</a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="about.html">¿Qué es integrity watch?</a></li>
					<li><a href="contact.html">Contacto</a></li>
				</ul>
			</div>
	 </div><!-- container -->
</nav>
<div class="container_wrap cm_header" id="about_wrap_top">&nbsp;</div>

<div class="container_wrap filter_cm" id="filter_wrap">
	<div class="container">
		<div class="row">
			<div class="col-md-4" id="filter_field_container">
				<p>Buscar o Filtrar:</p>
				<div class="input-group">
						<input type="text" id="search-input" class="form-control input-lg" placeholder="Filter by Lobbyist, Host, Subject…">
				</div>
			</div>
			<div class="col-md-7" id="filter_numbers">
				<div class="row">
					<div class="col-md-2" id="currently_selected_text"><p>Actualmente seleccionado:</p></div>
					
					<div class="col-md-2 filter_number">
						<div id="mep_number" class="dc-data-count">
							<span id="abig_number" class="big_number filter-count"></span>out of <strong class="total-count"></strong><br /> declaraciones
						</div>
					</div>
					<!--
					<div class="col-md-2 filter_number">
						<div id="org_number" class="org-count">
							<span class="big_number filter-count"></span>out of <strong class="total-count"></strong><br />organisations
						</div>
					</div>
					-->

					</div>
				</div>
			<div class="col-md-1" id="resetall_container">
				<button class="btn resetall">RESET<br />FILTERS</button>
			</div>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-md-4"></div>
	<div class="col-md-4"></div>
	<div class="col-md-4"></div>
</div>
<div id="ec">
	<div class="container_wrap" id="main_charts_wrap">
		<div class="container">
			<div class="row">
				<!-- COL1 -->
				<div class="col-md-5">
					<div class="chart_box">
						<h3>Nombre istitucion<!--span class="info">info</span--></h3>
						<div class="info_chart">
							<span class="info">info</span>
							<p class="desc">
							</p>
						</div>
						<div class="filter_btn_container">
							<img src="./img/G1.png" id="gobierno_btn" /><img src="./img/C1.png" id="diputados_btn" /><img src="./img/S1.png" id="senado_btn" />
						</div>
						<!--
						<div class="topistitucion chart-full"></div>
						<div class="label">Contacts</div>
						-->
						<br class="clear" />
					</div>
					<!-- TIPO -->
					<div class="chart_box" id="dectype">
						<h3>Tipo de declaraciones<!--span class="info">info</span--></h3>
						<div class="info_chart">
						</div>
						<div class="dectype"></div>
						<div class="legend">
						</div>
						<br class="clear" />
					</div>
				</div>
				<!-- COL2 -->
				<div class="col-md-7">
					<!-- CARGO -->
					<div class="chart_box" id="hosttype">
						<h3>Derechos o Acciones<!--span class="info">info</span--></h3>
						<div class="info_chart">
						</div>
						
						<!-- <div class="income"></div> -->
						<div class="accionesval chart-full"></div>
						<div class="legend">
						</div>
						<br class="clear" />
					</div>
					<!-- TOP10 -->
					<div class="row">
						<div class="col-md-6">
							<div class="chart_box">
								<h3>Proporcion nombre de<br />actividades<!--span class="info">info</span--></h3>
								<div class="info_chart">
									<span class="info">info</span>
									<p class="desc">
									</p>
								</div>
								<div class="nactividades chart-full"></div>
								<div class="label"></div>
								<br class="clear" />
							</div>
						</div>
						<div class="col-md-6">
							<div class="chart_box" id="group_container">
								<h3>Proporcion de actividades professionales</h3>
								<div class="info_chart">
									<span class="info">info</span>
									<p class="desc"></p>
								</div>
									<div class="nproactividades chart-full"></div>
									<div class="label"></div>
								<br class="clear" />
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- ADDITIONAL GRAPHS -->
			<div id="detailCharts">
				<div class="row">
					<div class="col-md-4">
						<div class="chart_box">
							<h3>Nombre de<br />veiculos<!--span class="info">info</span--></h3>
							<div class="info_chart">
								<span class="info">info</span>
								<p class="desc">
								</p>
							</div>
							<div class="vehicles chart-full"></div>
							<div class="label"></div>
							<br class="clear" />
						</div>
					</div>
					<div class="col-md-4">
						<div class="chart_box">
							<h3>Nombre de<br />comunidades, sociedades, empresas<!--span class="info">info</span--></h3>
							<div class="info_chart">
								<span class="info">info</span>
								<p class="desc">
								</p>
							</div>
							<div class="empresas chart-full"></div>
							<div class="label"></div>
							<br class="clear" />
						</div>
					</div>
					<div class="col-md-4">
						<div class="chart_box">
							<h3>Nombre de<br />bienes inmuebles<!--span class="info">info</span--></h3>
							<div class="info_chart">
								<span class="info">info</span>
								<p class="desc">
								</p>
							</div>
							<div class="inmuebles chart-full"></div>
							<div class="label"></div>
							<br class="clear" />
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<div class="chart_box">
							<h3>Top 10<br />professions<!--span class="info">info</span--></h3>
							<div class="info_chart">
								<span class="info">info</span>
								<p class="desc">
								</p>
							</div>
							<div class="topprofessions chart-full"></div>
							<div class="label"></div>
							<br class="clear" />
						</div>
					</div>
					<div class="col-md-6">
						<!--
						<div class="chart_box" id="group_container">
							<h3>Acciones</h3>
							<div class="info_chart">
								<span class="info">info</span>
								<p class="desc"></p>
							</div>
								<div class="accionesval chart-full"></div>
								<div class="label"></div>
							<br class="clear" />
						</div>
						-->
					</div>
				</div>
			</div>
		</div>
	</div>	
</div>

<div class="container_wrap" id="list_container">
	<div class="container">
		<div class="row">
			<div class="content" id="list_content">
				<h2 class="table_title">Meetings 
					<!--
					<div class="info_chart">
						<span class="info">info</span>
						<p class="desc">Click on any meeting for additional information.
						</p>
					</div>
					-->
				</h2><div id="last_update">Last updated: <span id="updatedate"></span></div>
			</div>
			
			<div class="col-md-12 table-responsive">
				<table class="table table-hover dc-data-grid tablesorter-bootstrap">
					<thead>
						<tr class="header">
							<th class="header">Nr</th> 
							<th class="header">Nombre</th> 
							<th class="header">Cargo</th> 
							<th class="header">Partido</th> 
							<th class="header">Actividades</th> 
							<th class="header">Propriedades</th> 
							<th class="header">Vehiculos</th>
							<th class="header">Salario Bruto</th> 
							<th class="header">Valor total activos</th> 
							<th class="header">Activos adicionales</th> 
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>
</div>

<script>
	'use strict';

	//New subategories
	var newSubcat = {"Law firms":"Law firms","Professional consultancies":"Professional consultancies","Self-employed consultants":"Self-employed consultants","Companies & groups":"Companies & groups","Other in house lobbyists":"Other in house lobbyists","Trade and business organisations":"Trade and business organisations","Trade unions":"Trade unions","Trade unions and professional associations":"Trade unions","Trade, business & professional associations":"Unknown","Non-governmental organisations, platforms and networks and similar":"Non-governmental organisations, platforms and networks and similar","Academic institutions":"Academic institutions","Think tanks and research institutions":"Think tanks and research institutions","Organisations representing churches and religious communities":"Churches & religious communities","Local, regional and municipal authorities (at sub-national level)":"Unknown","Other public or mixed entities, created by law whose purpose is to act in the public interest":"Other public or mixed entities","Other public or mixed entities, etc.":"Other public or mixed entities","Other sub-national public authorities":"Other sub-national public authorities","Regional structures":"Regional structures","Transnational associations and networks of public regional or other sub-national authorities":"Transnational public networks","Unknown":"Unknown"};

	//Set last updates as yesterday's date
	var monthNames = ["January", "February", "March", "April", "May", "June","July", "August", "September", "October", "November", "December"];
	var updatedate = new Date();
	updatedate.setDate(updatedate.getDate() - 1);
	$('#updatedate').html(updatedate.getDate() + ' ' + monthNames[updatedate.getMonth()] + ' ' + updatedate.getFullYear());

	var events=[];
	var activity=[];
	var inmueble=[];
	var mueble=[];
	var acciones=[];
	var valores=[];
	var pasivos=[];
	
	var partiesSenate = [];
	var parties = [];
	
	var meetingspages;
	var evt=null;
	var nameEvent=null;
	var representatives={};
	var countriesISO={};
		
	String.prototype.capitalize = function() {
		return this.charAt(0).toUpperCase() + this.slice(1);
	}
	
	function getFullName(d){
		return d.NombreDeclarante + ' ' + d.ApellidoPaternoDeclarante + ' ' + d.ApellidoMaternoDeclarante;
	}
	
	$(function() {
		var renderLoaded  = _.after(2,  function () { 
			//var dateFormat = d3.time.format("%Y-%m-%d %H:%M:%S");
			var dateFormat = d3.time.format("%d/%m/%Y");
			var now = Date.now();
			var a;
			
			//Loop through dataset and fix/adjust data
			_.each (events, function (d) {

				d.date = dateFormat.parse(d.FDeclaracion);
				d.fullName = getFullName(d);
				
				
				//Party
				
				d.party = "";
				d.party = _.find(parties,function (m) { return m.Diputado.toLowerCase() == d.fullname });
				
				if(d.party){
					d.party = d.party.Partido;
				} else {
					var thisPartySenate = _.find(partiesSenate,function (m) { return m.Name.toLowerCase() == d.fullname });
					if(thisPartySenate){
						d.party = thisPartySenate.Partido.trim();
					} else {
						//alert(d.fullname);
						d.party = "N/A";
					}
				}
				
				//alert(d.fullName);
				
				var thisActivity = _.filter(activity, function(a) {
					return getFullName(a) == getFullName(d);
				});
				var thisActivityProf = _.filter(thisActivity, function(a) {
					return a.TipoActividad == 'PROFESIONAL';
				});
				var thisInmueble = _.filter(inmueble, function(a) {
					return getFullName(a) == getFullName(d);
				});
				var thisMueble = _.filter(mueble, function(a) {
					return getFullName(a) == getFullName(d);
				});
				var thisAcciones = _.filter(acciones, function(a) {
					return getFullName(a) == getFullName(d);
				});
				var thisValores = _.filter(valores, function(a) {
					return getFullName(a) == getFullName(d);
				});
				var thisPasivos = _.filter(pasivos, function(a) {
					return getFullName(a) == getFullName(d);
				});
				
				d.activity = thisActivity;
				d.activityPro = thisActivityProf;
				d.inmueble = thisInmueble;
				d.mueble = thisMueble;
				d.acciones = thisAcciones;
				d.valores = thisValores;
				d.pasivos = thisPasivos
				
				d.accionestot = 0;
				_.each (d.acciones, function (t) {
					d.accionestot += parseInt(t.Valor);
				});
				
				d.valorestot = 0;
				_.each (d.valores, function (t) {
					d.valorestot += parseInt(t.ValorPlaza);
				});
				
				//alert(d.toSource());
				
			});
			//End loop through dataset
			
			//Call grid function to create and display charts
			grid ("#ec",events);
		});
		//End RenderLoaded
		
		//Load datasets
		  
		d3.csv("data/chileassets/declaration.csv", function(rows) {
			events = rows;
			renderLoaded();
		});  
		d3.csv("data/chileassets/activity.csv", function (rows) {
			activity = rows;
		}); 
		d3.csv("data/chileassets/inmueble.csv", function (rows) {
			inmueble = rows;
		});
		d3.csv("data/chileassets/mueble.csv", function (rows) {
			mueble = rows;
		}); 
		d3.csv("data/chileassets/valores.csv", function (rows) {
			valores = rows;
		}); 
		d3.csv("data/chileassets/pasivos.csv", function (rows) {
			pasivos = rows;
		}); 
		d3.csv("data/iw-chile-party.csv", function (rows) {
			parties = rows;
		});
		d3.csv("data/iw-chile-party-senate.csv", function (rows) {
			partiesSenate = rows;
		});
		d3.csv("data/chileassets/acciones.csv", function (rows) {
			acciones = rows;
			renderLoaded();
		}); 
		
		
		
		//Filter buttons
		var diputadosfilter = false;
		var senadofilter = false;
		var gobiernofilter = false;

		//Diputados filter
		$("#gobierno_btn").click(function() {
			if($("#senado_btn").attr("src") == "img/S2.png" && $("#diputados_btn").attr("src") == "img/C2.png"){
				$(".resetall").click();
				return;
			}
			gobiernofilter = true;
			diputadosfilter = false;
			senadofilter = false;
			nameEvent.filter(function (d) { 
				//alert(d);
				return d.indexOf("cargo:gobernador") !== -1 || d.indexOf("cargo:intendente") !== -1 || d.indexOf("cargo:ministro") !== -1 || d.indexOf("cargo:subsecretario") !== -1;
			});
			$("#gobierno_btn").attr("src", "img/G1.png");
			$("#diputados_btn").attr("src", "img/C2.png");
			$("#senado_btn").attr("src", "img/S2.png");
			//countOfficialsWall(wall.dimension().top(Infinity));
			dc.redrawAll();
		});
		//Diputados filter
		$("#diputados_btn").click(function() {
			if($("#senado_btn").attr("src") == "img/S2.png" && $("#gobierno_btn").attr("src") == "img/G2.png"){
				$(".resetall").click();
				return;
			}
			gobiernofilter = false;
			diputadosfilter = true;
			senadofilter = false;
			nameEvent.filter(function (d) { 
				//alert(d);
				return d.indexOf("cargo:camara") !== -1;
			});
			$("#gobierno_btn").attr("src", "img/G2.png");
			$("#diputados_btn").attr("src", "img/C1.png");
			$("#senado_btn").attr("src", "img/S2.png");
			//countOfficialsWall(wall.dimension().top(Infinity));
			dc.redrawAll();
		});
		$("#senado_btn").click(function() {
			if($("#diputados_btn").attr("src") == "img/C2.png" && $("#gobierno_btn").attr("src") == "img/G2.png"){
				$(".resetall").click();
				return;
			}
			gobiernofilter = false;
			diputadosfilter = false;
			senadofilter = true;
			nameEvent.filter(function (d) { 
				//alert(d);
				return d.indexOf("cargo:senador") !== -1;
			});
			$("#gobierno_btn").attr("src", "img/G2.png");
			$("#diputados_btn").attr("src", "img/C2.png");
			$("#senado_btn").attr("src", "img/S1.png");
			//countOfficialsWall(wall.dimension().top(Infinity));
			dc.redrawAll();
		});
	
		

		//Search field function
		$("#search-input").keyup (function () {
			var s = $(this ).val().toLowerCase();
			nameEvent.filter(function (d) { 
				return d.indexOf (s) !== -1;} );
			$(".resetall").attr("disabled",false);
			throttle();
			var throttleTimer;
			function throttle() {
				window.clearTimeout(throttleTimer);
				throttleTimer = window.setTimeout(function() {
					console.log ("redraw");
						dc.redrawAll();
				}, 250);
			}
		});
		
		//Reset button
		$(".resetall").click(function() {
			nameEvent.filter(null);
			dc.filterAll();
			dc.renderAll();
			$("#search-input").val("");
			//$(".resetall").attr("disabled",true);
			$("#gobierno_btn").attr("src", "img/G1.png");
			$("#diputados_btn").attr("src", "img/C1.png");
			$("#senado_btn").attr("src", "img/S1.png");
			diputadosfilter = false;
			senadofilter = false;
			gobiernofilter = false;
		}); 
	});      

</script>



<script>
	//Google Analytics
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-55613514-1', 'auto');
	ga('send', 'pdateview');
</script>
</body>
</html>
